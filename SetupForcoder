#!/usr/bin/env bash
# SetupForcoder — Bootstrap inicial
# Autor: Comunidade Forcoder • Licença: MIT
# Versão: 0.2.1

set -Eeuo pipefail
VERSION="0.2.1"

# ===== Cores =====
amarelo="\e[33m"
verde="\e[32m"
branco="\e[97m"
vermelho="\e[91m"
reset="\e[0m"

# ===== Funções visuais =====
banner() {
clear
echo -e "$amarelo===================================================================================================$reset"
echo -e "$amarelo=                                                                                                 $amarelo=$reset"
echo -e "$amarelo=   $branco   ███████╗ ██████╗ ██████╗  ██████╗  ██████╗ ██████╗ ███████╗██████╗                  $amarelo=$reset"
echo -e "$amarelo=   $branco   ██╔════╝██╔═══██╗██╔══██╗██╔════╝ ██╔═══██╗██╔══██╗██╔════╝██╔══██╗                 $amarelo=$reset"
echo -e "$amarelo=   $branco   █████╗  ██║   ██║██████╔╝██║      ██║   ██║██║  ██║█████╗  ██████╔╝                 $amarelo=$reset"
echo -e "$amarelo=   $branco   ██╔══╝  ██║   ██║██╔══██╗██║      ██║   ██║██║  ██║██╔══╝  ██╔══██╗                 $amarelo=$reset"
echo -e "$amarelo=   $branco   ██║     ╚██████╔╝██║  ██║╚██████╗ ╚██████╔╝██████╔╝███████╗██║  ██║                 $amarelo=$reset"
echo -e "$amarelo=   $branco   ╚═╝      ╚═════╝ ╚═╝  ╚═╝ ╚═════╝  ╚═════╝ ╚═════╝ ╚══════╝╚═╝  ╚═╝                 $amarelo=$reset"
echo -e "$amarelo=                                                                                                 $amarelo=$reset"
echo -e "$amarelo=                                          $branco v${VERSION} $amarelo                                            $amarelo=$reset"
echo -e "$amarelo===================================================================================================$reset"
echo ""
}


msg_ok()   { echo -e "  ${verde}[OK]${reset} $1"; }
msg_info() { echo -e "  ${amarelo}[*]${reset} $1"; }
msg_err()  { echo -e "  ${vermelho}[ERRO]${reset} $1"; }

# ===== Execução =====
banner
msg_info "Projeto open-source para bootstrap do instalador principal."
msg_info "VPS alvo: Ubuntu 22.04 / 24.04 (recomendado)."
echo ""

export DEBIAN_FRONTEND=noninteractive
APTFLAGS=(-y -o Dpkg::Options::="--force-confnew")

msg_info "Atualizando pacotes do sistema..."
apt-get update -qq && apt-get upgrade -qq -y && msg_ok "Sistema atualizado." || msg_err "Falha no update/upgrade."

msg_info "Instalando dependências essenciais..."
apt-get install -qq "${APTFLAGS[@]}" \
  ca-certificates curl git sudo unzip apt-utils jq dialog apache2-utils python3 neofetch \
  && msg_ok "Dependências instaladas." || msg_err "Falha ao instalar dependências."

# ===== Baixar e rodar instalador principal =====
REPO_URL="https://raw.githubusercontent.com/BrunoHoinacki/setup-forcoder/main/Setup"
TARGET="Setup"

[ -f "$TARGET" ] && msg_info "Removendo instalador antigo..." && rm -f "$TARGET"

msg_info "Baixando instalador principal..."
curl -fsSL "$REPO_URL" -o "$TARGET" && chmod +x "$TARGET" && msg_ok "Instalador pronto."

echo ""
msg_ok "Bootstrap finalizado com sucesso!"
msg_info "Executando instalador principal..."
echo ""

exec "./$TARGET"
